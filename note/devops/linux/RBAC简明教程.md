<div align="center">
  <img
  src="https://gitlab.ekwing.com/gz-server/fe-devops/uploads/3bd2814fd1aa82d794160c9a36b4febe/image.png" alt="RBAC Tutorial"/>
  <h1 align="center">
  RBAC简明教程
  </h1>
</div>

RBAC是计算机当中一种权限控制的思想，这种思想的核心是通过在用户和权限之间设计一个叫做角色的概念，然后通过给角色分配权限，再把角色分配给用户，来间接达到给用户分配权限的目的。

- **[概述](#概述)**
- **[认证与授权](#认证与授权)**
- **[实例](#实例)**

## 概述

---
RBAC是英文**Role-Based Access Control**的缩写，翻译成中文来说意思就是**基于角色的权限控制**。这种设计思想的本质目的其实是为了让用户跟权限之间解耦开来，说白了就是不想要用户跟权限这两者之间产生紧密的依赖关系，而是通过定义一个个角色，让用户去充当这些角色，来间接完成权限的分配。

本文书写的目的在于让参与本项目开发的人员能够快速上手RBAC的概念，进而在开发当中查看相关代码的时候不会觉得突兀，同时起到复习RBAC的知识作用。本文尽量使用通俗易懂的语言去描述一个用户，一个角色，一堆权限之间是如何产生关联的，并最终辅以实际案例去巩固所学内容。因此，文中描述言语不够严谨之处欢迎指出修正。

## 认证与授权

---
认证和授权是计算机安全机制当中常常一起出现的两个关键词，正因为一起出现的缘故，有些人可能就把认证跟授权认为是一个知识的两个不同的表达方式。实际上，认证跟授权并不是一个东西，而是两种不同的概念。**认证**要解决的问题是“**你是谁？**”，而**授权**要解决的问题是“**你有权利做啥？**”。因此，首先要明白两个概念要解决的问题是不相同的。

### 什么是认证？

以后台管理系统来举例，如果你想要进入一个系统的后台，那么你要解决的问题就是“怎么进入？”。于是为了解决这样一个问题，一般的管理后台都会开发出一个登录的功能，只需要你输入账号之后输入密码，告诉系统你是谁？这个问题往往解决迎刃而解了，没错，这就是认证——**告诉我，你是谁**？只需要给系统报上你的名字，系统就可以在数据库那边查询有没有你这个人，有这个人的话同时你给的进入系统的密码是正确的，那么认证通过，允许你进入系统里头玩耍，否则认证失败，不允许你进入系统。当然实际上认证的方式很多，除了账号密码在web当中还有token认证等常见的认证方式就不一一赘述了。

### 什么是授权？

当你告诉了系统你是谁并被系统承认之后，你抱着激动的心情兴高采烈的进入到了系统的后台，却一下子傻眼了，虽然你成功了进入了后台，但是你看到的除了“欢迎进入PornHub后台”的欢迎文案以外，页面一片空白。此时，你联系超级管理员，他告诉你：“不好意思，后台不是每个人看到的界面都一样的，你不是VIP，所以无法搜索到自己想要看的大型武侠动作片。”垂头丧气地退出后台后你不禁感慨：原来我佛只渡VIP，不渡穷逼！
没错，**认证**只是进入系统的门槛，进入了系统的你还是会被分成了三六九等的，这就是**授权**，它告诉了你你到底有权利做啥？正如你每天上班，进入公司时用指纹按钮，告诉门禁系统你是谁，通过之后，你就可以进入公司了， 但是这仅仅是告诉了系统你确实是公司的人。而具体你进入到公司了，有什么权利做什么事这又是另一码事儿。
RBAC——基于角色的权限控制就是属于授权机制中的一种设计方案（思想），要学会它，必须首先明白它要解决的是**授权**的问题，而不是**认证**的问题。当然授权除了这种方式还有很多方式，典型的还有ABAC，K8S早期默认用这种方式，后来默认用的就是RBAC的授权方式。

## 如何理解RBAC？

---

**基于角色的权限控制**（RBAC）这个概念看上都是中文，但是合起来读就显得文绉绉的。我们先问自己两个问题：

- 控制谁？
- 访问谁？

解答第一个疑问其实是很简单的，授权机制的发明就是为了作用到人的身上，就是为了想要不同的人拥有不同的权利去做同一件事情（或者多件事情）。

❓问题1：因此，控制谁？没错！就是为了控制人，张全蛋能够在PornHub后台搜索大型武侠动作片，是因为他有权利，而你没法搜索，是因为你没权利，仅此而已。授权，就是授予权利，整个过程要解决的就是权利给予的这个问题罢了。

❓问题2：访问谁？要解决这个访问谁的问题，首先我们就得回到上一个问题。我们知道，授权最终就是为了划分不同的人拥有着不同的权利去做同一件事。那因此访问谁这个问题也就有了答案，即你要做什么事，那你就是访问那件事。你跟张全蛋同时做了一件事：在PornHub的后台搜索大型武侠动作片，不同的是张全蛋被赋予了“搜索”的权利，你没有。总结就是，要去做什么事，就是访问谁。
因此，目前授权的基础脉络就产生了：【你和张全蛋（控制谁）】【要在PortHub的后台搜索大型武侠动作片（访问谁）】。这里为止，我们引入了RBAC当中参与的两个实体，一个是**访问者**，一个是**资源**。于是，我们不禁又要产生一个新的问题：

- 你和张全蛋都在做同一件事，那么为啥你们会得到不同的结果？（张全蛋可以搜索大型武侠动作片，你不能搜索）

❓问题3：解决这个问题的答案就是：系统给了你跟张全蛋不一样的权利，系统说我允许张全蛋在Pornhub的后台里头搜索大型武侠动作片，而不允许你搜索，猜测可能是因为张全蛋每个月都花了不少钱在Pornhub上做出了卓越贡献。不过，到目前为止，你总算是知道自己跟张全蛋为啥在做同一件事上得到了两个不同的结果——权利不一样。到这里我们又引出了RBAC当中的第三个实体——**权限**。两个不同的**访问者**，访问同一份**资源**，因为**权限**不同，所以得到了不一样的结果。

直接对访问者和权限之间进行一个绑定，其实就已经完成了一个基本的权利授予的过程。一开始，你跟张全蛋都是被授予了进入Pornhub后台的全部功能，日子渐久，Pornhub获得了广大人民群众的一致好评，后台访问的人多了，Pornhub公司便开始思考付费制了。公司想要对那些付费的用户基于搜索大型武侠动作片的功能，而那些白嫖的穷逼则只能不断点击下一页去肉眼搜索自己想要看的片子。那么一个新的问题产生了：

- 如何优雅的设计一个权限方案，来区分这帮人呢？

也许你会不假思索地回答：“那要不就对用户一个个判断是否是付费的来区分，进而给予权限不就好了吗？”这样做其实也可以，但是如果还有新的功能，允许购买这个功能的用户进一步可以编辑片子和下载片子，那又的一个个去判断，要知道Pornhub大获好评之后，访问人数众多，这么去判断系统很累的。同时，还有可能出现，有的人只想要搜索片子的功能，有的人想要搜索、编辑、下载三种功能，也有的人只想要搜索、下载的功能。这可怎么办呢？

为了解决这个问题，人们想到了一种新的办法：我们何不将这些功能打包在一块，进行不同的组合，并给这些功能组合起一个名字，并且卖出去呢？没错！角色概念的因此诞生了！只要你在Pornhub上购买了这个角色，你就拥有了这个角色相关的权利，就可使用角色对应的功能。角色，这个概念，就是代表着一组功能，一组规则，一组权利。就是如此简单，有没有？（PS：其实某度云网盘的VIP，超级VIP会员就是这样的，不同的角色拥有不同的权限，所以说学习RBAC还是有脉络的嘛！）到这里我们又最终引入了RBAC当中的第四个实体——**角色**。

> 学习TIP：其实，把角色理解成一组权限的组合就可以减少知识脉络之间多了一个新概念的理解。比如要想理解A必须理解B，此时你已经理解了A和B，现在由于某种需求需要在A和B之间引入C的概念，你只需要找联系，用A的概念等价替换C，或者用B的概念等价替换C，就可以比较轻松没有太大压力的学习A-C-B这条知识了。

总结基础的RBAC概念：访问人通过访问资源，因为获取到的资源权利不一样，而导致对访问到的资源所具有的操作是不相同的。同时这些操作权限可以被根据实际需要打包成一组权限，然后给这组操作权限起了一个名字叫做角色。之后就可以把这个角色（这组权限）赋予给了某一个访问人，于是这个访问人就担任了这个角色，就拥有了一组操作这个资源的权限，就可以对这个资源做相应的操作了。这就是RBAC，是不是很简单？

## 实例

1. 翼赛业务线新开发了一个考试前模拟练习的模块，该模块并不是免费的，现在公司的需求是：希望对付费的VIP会员开放所有的考试练习，查看解析，不限次数三大功能，但是对白嫖穷逼只有考试练习的功能。现在马云和马化腾两个人分别使用了翼赛进行学习，马云充钱了，马化腾想白嫖，请你尝试画出该需求的RBAC0的模型简图。
   答案如下：

<div align="center">
  <img
  src="https://gitlab.ekwing.com/gz-server/fe-devops/uploads/150cec1c34edfefe32bdc8a1762c6452/image.png" alt="RBAC Practice"/>
</div>
